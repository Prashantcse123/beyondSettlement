openapi: 3.0.0
info:
  description: Beyond Settelments
  version: 1.0.0
  title: Beyond Settelments APIs
tags:
  - name: Auth
    description: Authentication API
  - name: Calculations
    description: Operations with scorecard
  - name: Source-data
    description: Operations with source data
  - name: Users
    description: User Profile
  - name: Tradelines
    description: Operations with tradelinestate and service
  - name: Roles
    description:  Operations with roletree and synchronize with CRM
paths:
  /login:
    post:
      tags:
        - Auth
      summary: Authenticate users
      description: Authenticate user using login credentials API
      responses:
        '200':
          description: Authentication successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    type: object
                    properties:
                      username:
                        type: string
                      _id:
                        type: string
                  token:
                    type: string
        '401':
          description: Unauthorized
        '500':
          description: Internal server error
      requestBody:
        content:
          application/json:
            schema:
              type: object
              example:
                username: abc
                password: '123'
              required:
                - username
                - password
              properties:
                username:
                  type: string
                password:
                  type: string
                  format: password
        description: User's credentials
        required: true
  /calculations/scorecard/set:
    get:
      security:
        - salesforceAuth:
            - 'admin'
            - 'user'
      tags:
        - Calculations
      summary: Start scorecard calculation
      description: Start scorecard calculation API
      responses:
        '200':
          description: Successfully start scorecard calculation
        '401':
          description: Unauthorized
        '500':
          description: Internal server error
  /calculations/eligibility/set:
    get:
      security:
        - salesforceAuth:
            - 'admin'
            - 'user'
      tags:
        - Calculations
      summary: Start eligibility calculation
      description: Start eligibility calculation API
      responses:
        '200':
          description: Successfully start eligibility calculation
        '401':
          description: Unauthorized
        '500':
          description: Internal server error
  /calculations/scorecard:
    get:
      security:
        - salesforceAuth:
            - 'admin'
            - 'user'
      tags:
        - Calculations
      summary: Get scorecard
      description: Get Scorecard API
      responses:
        '200':
          description: Scorecard generated successfuly
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/ScorecardResponse'
                  page:
                    type: integer
                  page_size:
                    type: integer
                  total_count:
                    type: integer
                  page_count:
                    type: integer
        '401':
          description: Unauthorized
        '500':
          description: Internal server error
  /calculations/scorecard_eligible:
    get:
      security:
        - salesforceAuth:
            - 'admin'
            - 'user'
      tags:
        - Calculations
      summary: Scorecard eligible
      description: Scorecard eligible API
      responses:
        '200':
          description: Scorecard eligible generated
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/ScorecardResponse'
                  page:
                    type: integer
                  page_size:
                    type: integer
                  total_count:
                    type: integer
                  page_count:
                    type: integer
        '401':
          description: Unauthorized
        '500':
          description: Internal server error
  /calculations/update_scorecard:
    put:
      security:
        - salesforceAuth:
            - 'admin'
            - 'user'
      tags:
        - Calculations
      summary: Update scorecard details
      description: Update scorecard API
      responses:
        '200':
          description: successfully update scorecard
        '401':
          description: Unauthorized
        '500':
          description: Internal server error
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - tradeLineId
                - isDone
              properties:
                tradeLineId:
                  type: integer
                isDone:
                  type: boolean
        description: Send updated data values in request body
        required: true
  /calculations/client_ranking:
    get:
      security:
        - salesforceAuth:
            - 'admin'
            - 'user'
      tags:
        - Calculations
      summary: Client ranking
      description: Client ranking API
      parameters:
        - in: query
          name: sortBy
          description: Use for sorting the data
          schema:
            type: string
        - in: query
          name: sortOrder
          description: Use for sorting the data
          schema:
            type: string
        - in: query
          name: page
          description: Use for pagination
          schema:
            type: integer
        - in: query
          name: page_size
          description: Use for pagination
          schema:
            type: integer
      responses:
        '200':
          description: Client ranking data successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/ScorecardResponse'
                  page:
                    type: integer
                  page_size:
                    type: integer
                  total_count:
                    type: integer
                  page_count:
                    type: integer
        '401':
          description: Unauthorized
        '500':
          description: Internal server error
  /calculations/progress:
    get:
      security:
        - salesforceAuth:
            - 'admin'
            - 'user'
      tags:
        - Calculations
      summary: Scorecard progress
      description: Scorecard progress
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  type:
                    type: string
                  task:
                    type: string
                  value:
                    type: number
                  createdAt:
                    type: string
                  updatedAt:
                    type: string
        '401':
          description: Unauthorized
        '500':
          description: Internal server error
  /calculations/status:
    get:
      security:
        - salesforceAuth:
            - 'admin'
            - 'user'
      tags:
        - Calculations
      summary: Scorecard status
      description: Scorecard progress
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  busy:
                    type: boolean
                  progress:
                    type: number
                  task:
                    type: string
        '401':
          description: Unauthorized
        '500':
          description: Internal server error
  /roles_tree:
    get:
      security:
        - salesforceAuth:
            - 'admin'
            - 'user'
      tags:
        - Roles
      summary: Get roles tree
      description: Get roles tree API
      responses:
        '200':
          description: Successfully get roles tree
        '401':
          description: Unauthorized
        '500':
          description: Internal server error
  /sync_from_crm:
    get:
      security:
        - salesforceAuth:
            - 'admin'
            - 'user'
      tags:
        - Roles
      summary: Synchronize from CRM
      description: Synchronize from CRM API
      responses:
        '200':
          description: Successfully synchronize with CRM
        '401':
          description: Unauthorized
        '500':
          description: Internal server error
  /source/data/get:
    get:
      security:
        - salesforceAuth:
            - 'admin'
            - 'user'
      tags:
        - Source-data
      summary: Get source data
      description: Get source data API
      responses:
        '200':
          description: Successfully import source data
        '401':
          description: Unauthorized
        '500':
          description: Internal server error
  /source/data/test:
    get:
      security:
        - salesforceAuth:
            - 'admin'
            - 'user'
      tags:
        - Source-data
      summary: Test source data
      description: Test source data API
      responses:
        '200':
          description: Successfully test source data
        '401':
          description: Unauthorized
        '500':
          description: Internal server error
  /tradeline/{tradelineId}:
    patch:
      security:
        - salesforceAuth:
            - 'admin'
            - 'user'
      tags:
        - Tradelines
      summary: Update tradelines state and service
      description: Update tradelines state and service API
      parameters:
        - in: path
          name: tradelineId
          schema:
            type: integer
          required: true
          description: tradeLineId for update tradelines state and service
      requestBody:
        description: tradelineBody
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Tradeline'
      responses:
        '200':
          description: Successfully update tradelines
          content:
            text/plain:
              schema:
                type: string
                example: "[1]"
        '401':
          description: Unauthorized
        '500':
          description: Internal server error
  /me:
    get:
      security:
        - salesforceAuth:
            - 'admin'
            - 'user'
      tags:
        - User Profile
      summary: Show user profile
      description: Show user profile
      responses:
        '200':
          description: Success
        '401':
          description: Unauthorized
        '404':
          description: No Profile Found
        '500':
          description: Internal server error
servers:
  - url: ''
components:
  securitySchemes:
    salesforceAuth:
      type: oauth2
      flows:
        implicit:
          authorizationUrl: ''
          refreshUrl: ''
          scopes:
            'admin': Admin scope
            'user': User scope
  schemas:
    Tradeline:
      type: object
      required:
        - id
        - isDone
        - status
        - teamLeadId
        - agentId
      properties:
        id:
          type: integer
        isDone:
          type: boolean
        status:
          type: integer
        teamLeadId:
          type: string
        agentId:
          type: string
    ScorecardResponse:
      type: object
      properties:
        id:
          type: integer
        tradeLineName:
          type: string
        tradeLineId:
          type: integer
        programName:
          type: string
        creditor:
          type: string
        eligibility:
          type: integer
        balance:
          type: integer
        endOfCurrentMonthFundAccumulation:
          type: integer
        lastWorkedOn:
          type: string
        creditorTerms:
          type: string
        metrics_creditorScore:
          type: integer
        metrics_stateOfResidency:
          type: string
        metrics_monthlyPayment:
          type: integer
        metrics_accountDelinquency:
          type: integer
        metrics_pctAvgSettlement:
          type: number
        metrics_settlementTerm:
          type: integer
        metrics_firstMonthFeeFundPct:
          type: number
        metrics_feeEstimate:
          type: number
        metrics_accountStatus:
          type: string
        metrics_enrolledDebt:
          type: number
        points_creditorScore:
          type: integer
        points_stateOfResidency:
          type: integer
        points_monthlyPayment:
          type: integer
        points_accountDelinquency:
          type: integer
        points_pctAvgSettlement:
          type: integer
        points_settlementTerm:
          type: integer
        points_firstMonthFeeFundPct:
          type: integer
        points_feeEstimate:
          type: integer
        points_accountStatus:
          type: integer
        points_enrolledDebt:
          type: integer
        weight_creditorScore:
          type: integer
        weight_stateOfResidency:
          type: integer
        weight_monthlyPayment:
          type: integer
        weight_accountDelinquency:
          type: integer
        weight_pctAvgSettlement:
          type: integer
        weight_settlementTerm:
          type: integer
        weight_firstMonthFeeFundPct:
          type: integer
        weight_feeEstimate:
          type: integer
        weight_accountStatus:
          type: integer
        weight_enrolledDebt:
          type: integer
        totalScore:
          type: integer
        rank:
          type: integer
        minAccountRank:
          type: integer
        accountRepeatCountByIndex:
          type: integer
        calculatedCreditScore:
          type: integer
        concatenatedIndex:
          type: integer
        createdAt:
          type: string
        updatedAt:
          type: string
